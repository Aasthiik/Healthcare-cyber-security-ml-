{% extends "base.html" %}

{% block title %}Register - Healthcare Cybersecurity{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-7 col-lg-6">
            <div class="card shadow-lg">
                <div class="card-body p-5">
                    <div class="text-center mb-4">
                        <i class="fas fa-user-plus text-primary" style="font-size: 4rem;"></i>
                        <h2 class="mt-3 fw-bold text-primary">Create Account</h2>
                        <p class="text-muted">Join our secure healthcare cybersecurity platform</p>
                    </div>
                    
                    <form method="POST" id="registerForm">
                        <div class="mb-3">
                            <label for="username" class="form-label fw-bold">
                                <i class="fas fa-user me-2"></i>Username
                            </label>
                            <input type="text" 
                                   class="form-control" 
                                   id="username" 
                                   name="username" 
                                   required
                                   minlength="3"
                                   placeholder="Choose a unique username">
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                Minimum 3 characters, letters and numbers only
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="email" class="form-label fw-bold">
                                <i class="fas fa-envelope me-2"></i>Email Address
                            </label>
                            <input type="email" 
                                   class="form-control" 
                                   id="email" 
                                   name="email" 
                                   required
                                   placeholder="Enter your email address">
                            <div class="form-text">
                                <i class="fas fa-shield-alt me-1"></i>
                                We'll never share your email with anyone
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="password" class="form-label fw-bold">
                                <i class="fas fa-lock me-2"></i>Password
                            </label>
                            <div class="input-group">
                                <input type="password" 
                                       class="form-control" 
                                       id="password" 
                                       name="password" 
                                       required
                                       minlength="6"
                                       placeholder="Create a strong password">
                                <button class="btn btn-outline-secondary" 
                                        type="button" 
                                        id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="password-strength mt-2">
                                <div class="progress" style="height: 5px;">
                                    <div class="progress-bar" id="passwordStrengthBar" style="width: 0%;"></div>
                                </div>
                                <small class="form-text" id="passwordStrengthText">
                                    Password strength: <span id="strengthLevel">Enter password</span>
                                </small>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label fw-bold">
                                <i class="fas fa-lock me-2"></i>Confirm Password
                            </label>
                            <input type="password" 
                                   class="form-control" 
                                   id="confirmPassword" 
                                   name="confirmPassword" 
                                   required
                                   placeholder="Confirm your password">
                            <div class="invalid-feedback" id="passwordMismatch">
                                Passwords do not match
                            </div>
                        </div>
                        
                        <div class="mb-4 form-check">
                            <input type="checkbox" class="form-check-input" id="agreeTerms" required>
                            <label class="form-check-label" for="agreeTerms">
                                I agree to the 
                                <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#termsModal">
                                    Terms of Service
                                </a> 
                                and 
                                <a href="#" class="text-primary" data-bs-toggle="modal" data-bs-target="#privacyModal">
                                    Privacy Policy
                                </a>
                            </label>
                        </div>
                        
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary btn-lg" id="registerBtn" disabled>
                                <i class="fas fa-user-plus me-2"></i>
                                <span id="registerText">Create Account</span>
                                <div class="loading d-none" id="registerLoading"></div>
                            </button>
                        </div>
                    </form>
                    
                    <hr class="my-4">
                    
                    <div class="text-center">
                        <p class="mb-0">Already have an account? 
                            <a href="{{ url_for('login') }}" class="text-primary fw-bold">
                                Sign in here
                            </a>
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Security Features -->
            <div class="row mt-4">
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <i class="fas fa-shield-alt text-success" style="font-size: 2rem;"></i>
                        <h6 class="mt-2 fw-bold">Secure</h6>
                        <small class="text-muted">End-to-end encryption</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <i class="fas fa-user-shield text-info" style="font-size: 2rem;"></i>
                        <h6 class="mt-2 fw-bold">Private</h6>
                        <small class="text-muted">Your data stays private</small>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="text-center p-3">
                        <i class="fas fa-rocket text-warning" style="font-size: 2rem;"></i>
                        <h6 class="mt-2 fw-bold">Fast</h6>
                        <small class="text-muted">Quick setup process</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Terms of Service Modal -->
<div class="modal fade" id="termsModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-file-contract me-2"></i>Terms of Service
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>1. Acceptance of Terms</h6>
                <p>By accessing and using this healthcare cybersecurity platform, you accept and agree to be bound by the terms and provision of this agreement.</p>
                
                <h6>2. Use License</h6>
                <p>Permission is granted to temporarily use this platform for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title.</p>
                
                <h6>3. Data Security</h6>
                <p>We implement industry-standard security measures to protect your data and ensure the confidentiality of all information processed through our system.</p>
                
                <h6>4. Limitations</h6>
                <p>In no event shall Healthcare Cybersecurity Platform or its suppliers be liable for any damages arising out of the use or inability to use the materials on the platform.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<!-- Privacy Policy Modal -->
<div class="modal fade" id="privacyModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">
                    <i class="fas fa-user-shield me-2"></i>Privacy Policy
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <h6>Information Collection</h6>
                <p>We collect information you provide directly to us, such as when you create an account, use our threat detection services, or contact us for support.</p>
                
                <h6>Information Use</h6>
                <p>We use the information we collect to provide, maintain, and improve our services, process transactions, and communicate with you.</p>
                
                <h6>Information Sharing</h6>
                <p>We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy.</p>
                
                <h6>Data Security</h6>
                <p>We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const registerForm = document.getElementById('registerForm');
    const registerBtn = document.getElementById('registerBtn');
    const registerText = document.getElementById('registerText');
    const registerLoading = document.getElementById('registerLoading');
    const togglePassword = document.getElementById('togglePassword');
    const passwordField = document.getElementById('password');
    const confirmPasswordField = document.getElementById('confirmPassword');
    const agreeTerms = document.getElementById('agreeTerms');
    const passwordStrengthBar = document.getElementById('passwordStrengthBar');
    const strengthLevel = document.getElementById('strengthLevel');
    
    // Password toggle functionality
    togglePassword.addEventListener('click', function() {
        const type = passwordField.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordField.setAttribute('type', type);
        
        const icon = this.querySelector('i');
        if (type === 'password') {
            icon.className = 'fas fa-eye';
        } else {
            icon.className = 'fas fa-eye-slash';
        }
    });
    
    // Password strength checker
    passwordField.addEventListener('input', function() {
        const password = this.value;
        let strength = 0;
        let strengthText = '';
        let strengthColor = '';
        
        if (password.length >= 6) strength += 1;
        if (password.match(/[a-z]+/)) strength += 1;
        if (password.match(/[A-Z]+/)) strength += 1;
        if (password.match(/[0-9]+/)) strength += 1;
        if (password.match(/[$@#&!]+/)) strength += 1;
        
        const strengthPercentage = (strength / 5) * 100;
        
        switch (strength) {
            case 0:
            case 1:
                strengthText = 'Very Weak';
                strengthColor = 'bg-danger';
                break;
            case 2:
                strengthText = 'Weak';
                strengthColor = 'bg-warning';
                break;
            case 3:
                strengthText = 'Fair';
                strengthColor = 'bg-info';
                break;
            case 4:
                strengthText = 'Good';
                strengthColor = 'bg-primary';
                break;
            case 5:
                strengthText = 'Strong';
                strengthColor = 'bg-success';
                break;
        }
        
        passwordStrengthBar.style.width = strengthPercentage + '%';
        passwordStrengthBar.className = `progress-bar ${strengthColor}`;
        strengthLevel.textContent = strengthText;
    });
    
    // Password confirmation validation
    function checkPasswordMatch() {
        if (confirmPasswordField.value && passwordField.value !== confirmPasswordField.value) {
            confirmPasswordField.classList.add('is-invalid');
            return false;
        } else {
            confirmPasswordField.classList.remove('is-invalid');
            return true;
        }
    }
    
    confirmPasswordField.addEventListener('input', checkPasswordMatch);
    passwordField.addEventListener('input', checkPasswordMatch);
    
    // Enable/disable register button
    function checkFormValid() {
        const username = document.getElementById('username').value.trim();
        const email = document.getElementById('email').value.trim();
        const password = passwordField.value;
        const confirmPassword = confirmPasswordField.value;
        const termsAccepted = agreeTerms.checked;
        
        const isValid = username.length >= 3 && 
                       email.includes('@') && 
                       password.length >= 6 && 
                       password === confirmPassword && 
                       termsAccepted;
        
        registerBtn.disabled = !isValid;
    }
    
    // Check form validity on input changes
    const formInputs = registerForm.querySelectorAll('input');
    formInputs.forEach(input => {
        input.addEventListener('input', checkFormValid);
        input.addEventListener('change', checkFormValid);
    });
    
    // Form submission with loading state
    registerForm.addEventListener('submit', function(e) {
        if (!checkPasswordMatch()) {
            e.preventDefault();
            return;
        }
        
        // Show loading state
        registerText.classList.add('d-none');
        registerLoading.classList.remove('d-none');
        registerBtn.disabled = true;
        
        // Reset loading state after a delay (in case of error)
        setTimeout(() => {
            registerText.classList.remove('d-none');
            registerLoading.classList.add('d-none');
            checkFormValid();
        }, 3000);
    });
    
    // Input validation styling
    const inputs = document.querySelectorAll('input[required]');
    inputs.forEach(input => {
        input.addEventListener('blur', function() {
            if (!this.checkValidity()) {
                this.classList.add('is-invalid');
            } else {
                this.classList.remove('is-invalid');
                this.classList.add('is-valid');
            }
        });
    });
    
    // Animate card entrance
    const card = document.querySelector('.card');
    card.style.opacity = '0';
    card.style.transform = 'translateY(30px)';
    card.style.transition = 'all 0.6s ease';
    
    setTimeout(() => {
        card.style.opacity = '1';
        card.style.transform = 'translateY(0)';
    }, 100);
});
</script>
{% endblock %}